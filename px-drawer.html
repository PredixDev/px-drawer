<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<!--
`px-drawer` is a navigation drawer that can slide in from the left, right, top or bottom.

<link href="../iron-overlay-behavior/iron-overlay-behavior.html" rel="import">
<p>
  For demo visit <a href="demo.html" target="_blank">Full demo here</a> or <a href="mobile-demo.html" target="_blank">Mobile demo here</a>
</p>

### Example

```
<div class="box">
  <style>
    body {
      --px-drawer-background-color: #555;
    }
  </style>
  <px-drawer id="drawer1" align="left">
    <p class="u-m">
      This is content inside of the drawer
    </p>
  </px-drawer>
  <button class="btn btn--full" onclick="document.getElementById('drawer1').toggle()">
    Toggle
  </button>
</div>
```

### Styling

Custom property | Description | Default
------------ | ------------- | ------------
`--px-drawer-background-color` | The background-color of the drawer  |  `#242326` *(gray10)*
`--px-drawer-width` | The width of the drawer | `256px`

@element px-drawer.html
@blurb px-drawer A responsive drawer.
@demo demo.html
@demo mobile-demo.html
@homepage index.html
-->
<dom-module id="px-drawer">
  <link rel="stylesheet" href="css/px-drawer.css">

  <style>
    :host {
      }
    :host .drawer {
      background-color: (--px-drawer-background-color, #242326);
      width: (--px-drawer-width, 256px);
      @apply(--px-drawer);
    }

    :host .drawer__overlay {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transition: opacity 0.2s ease;
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      opacity: 0;
      background: var(--px-drawer-overlay-background, rgba(0, 0, 0, 0.5));
      z-index: -1;
    }

    :host([opened]) > .drawer__overlay {
      opacity: 1;
      z-index: 201;
    }

    :host([opened][persistent]) > .drawer__overlay {
      visibility: hidden;
      /**
       * NOTE(keanulee): Keep both opacity: 0 and visibility: hidden to prevent the
       * scrim from showing when toggling between closed and opened/persistent.
       */
      opacity: 0;
    }

  </style>
  <template>
    <div id="overlay" class="drawer__overlay" on-tap="toggle"></div>
    <div id="drawer" class="drawer">
      <div id="drawerContent" class="drawer__content">
        <content id="contentContainer" select="*"></content>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'px-drawer',
      behaviors: [Polymer.IronResizableBehavior],
      properties: {
        /**
         * The state of the drawer
         */
        opened: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true,
          observer: '_openHandler'
        },
        /**
       * The drawer is a fixed width and cannot be closed.
       */
        persistent: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        /**
         * To position the drawer in fixed mode
         */
        fixed: {
          type: Boolean,
          value: false
        },
        /**
         * The theme to apply to the drawer (`dark`)
         * @default transparent
         */
        theme: {
          type: String,
          reflectToAttribute: true
        },
        /**
         * The alignment of the drawer on the screen (`left`, `right`)
         */
        align: {
          type: String,
          reflectToAttribute: true,
          value: 'left'
        },
        /**
         * The type of drawer (`temporary`, `persistent`, `mini`)
         */
        type: {
          type: String,
          value: 'temporary',
          reflectToAttribute: true,
          observer: '_typeHandler'
        }
      },
      listeners: {
        'overlay.tap': 'toggle',
        'iron-resize': '_resizeHandler'
      },
      observers: ['resetLayout(isAttached, condenses, fixed)'],
      _boundEscKeydownHandler: null,
      ready: function () {
        // Set the scroll direction so you can vertically scroll inside the drawer.
        this.setScrollDirection('y');
        this.toggleClass('drawer--' + this.align, true, this.$.drawer);

        if (this.theme) {
          this.toggleClass('drawer--' + this.theme, true, this.$.drawer);
        }

        if (this.fixed) {
          this.toggleClass('drawer--fixed', true, this.$.drawer);
        }

        if (this.persistent) {
          this.toggleClass('drawer--temporary', true, this.$.drawer);
          this.toggleClass('drawer--persistent', true, this.$.drawer);
        }
      },
      attached: function () {
        // capture all clicks so that we can close the dropdown if the user clicks anywhere outside the dropdown Enable document-wide tap recognizer.
        //
        //We should be using only 'tap', but this would be a breaking change.
        Polymer.RenderStatus.afterNextRender(this, function () {});
      //  Polymer.Gestures.add(document, 'tap', this._handleOffClick.bind(this));
        //document.addEventListener('tap', this._handleOffClick.bind(this), true); this._boundEscKeydownHandler = this._escKeydownHandler.bind(this);
        document.addEventListener('keydown', this._escKeydownHandler.bind(this));

      },
      detached: function () {
        document.removeEventListener('keydown', this._boundEscKeydownHandler);
      },
      /**
        * Handle toggling the drawer open or close.
        */
      toggle: function (type) {
        this.opened = !this.opened;
      },
      /**
       * Handle when a click is outside the drawer.
       */
      _handleOffClick: function (e) {
        if(this.opened){
          this.close();
        }
      },
      /**
       * Handle when the drawer opened state is changed.
       */
      _openHandler: function (newVal, oldVal) {
        console.log('_openHandler', newVal);
        this.toggleClass('is-open', newVal, this.$.drawer);
        this.fire('toggle', this);
      },
      /**
       * Handle when the drawer type is changed.
       */
      _typeHandler: function (newVal, oldVal) {
        console.log('_typeHandler');
        this.toggleClass('drawer--' + oldVal, false, this.$.drawer);
        this.toggleClass('drawer--' + newVal, true, this.$.drawer);

        if (this.persistent) {
          //  this.toggleClass('drawer--temporary');
        }
      },
      /**
     * Gets the width of the drawer.
     *
     * @return {Number} The width of the drawer in pixels.
     */
      getWidth: function () {
        return this.offsetWidth;
      },
      /**
       * Opens the drawer.
       */
      open: function () {
        this.opened = true;
      },
      /**
       * Closes the drawer.
       */
      close: function () {
        this.opened = false;
      },
      _escKeydownHandler: function (event) {
        var ESC_KEYCODE = 27;
        if (event.keyCode === ESC_KEYCODE) {
          event.preventDefault();
          this.close();
        }
      },
      resetLayout: function () {
        console.warn(this.tagName, 'resetLayout');
      },

      _resizeHandler: function () {
        this.resetLayout();
      }
    });
  </script>
</dom-module>
